<?xml version="1.0"?>

<document>

 <properties>
  <title>Configuration for James 1.2.1</title>
  <author email="sergek@lokitech.com">Serge Knystautas</author>
 </properties>

<body>

<section name="Configuration">

<p>
<blockquote>
        <p>This document explains the JAMES.conf.xml file for James 1.2.1
          <br>JAMES 1.2.1 is currently based on an older version of Avalon,
          specifically the <code>avalon-james-1-1b1</code> branch in CVS.
          </br>
        </p>
</blockquote>
</p>

</section>

<section name="James Server Configuration">
  <subsection name="James Configuration">
    <p>
        These tag elements control the JAMES spooling and identification
        settings.
    </p>
    <table border="1">
        <tr>
            <th>&lt;name&gt;</th>
            <th>default value</th>
            <th>meaning</th>
        </tr>
        <tr>
            <td> postmaster </td>
            <td> Postmaster@localhost </td>
            <td> Is the source of error replies and the email users will mail to for any problem.  You
            should change this to an address that can receive incoming messages.</td>
        </tr>
	<tr>
            <td> helloName</td>
            <td> attribute autodetect=TRUE and value of 'myMailServer'  </td>
            <td> The name by which James will identify itself in SMTP and POP3
	     greetings. If autodetect is TRUE James will attempt to detect
            automatically the name, failing which it will use 'localhost'. If
	    autodetect is not TRUE, James will use the specified name or 
	    'localhost' if none is specified. Look in jamesinfo.log for
	     lines like "[...] Local host is: [servername] and [...] Hello Name is: [machine name]"</td>
        </tr>
        <tr>
            <td> servernames/servername</td>
            <td> attribute autodetect=TRUE and last value of 'localhost'</td>
            <td> A list of host names James will consider as local. Any user [user]@[servername]
            will be considered to be local. If autodetect is TRUE James will attempt to detect
            automatically the name and use any names specified. Look in jamesinfo.log for a line like "[...] Handling mail for:: [domain/host]"</td>
        </tr>
        <tr>
            <td> spoolRepository </td>
            <td> file://../var/mail/spool/ </td>
            <td> This is the path where incoming messages are stored before beeing processed. </td>
        </tr>
        <tr>
            <td> inboxRepository </td>
            <td> file://../var/mail/localinbox/ </td>
            <td> This is the root for local users inbox. Each user will have a personal folder
            [inboxRepository]/[user] </td>
        </tr>
        <tr>
            <td> spoolmanagerthreads </td>
            <td> 1 </td>
            <td> This is the number of thread that work polling mails from the spool and take care
            of processing them. </td>
        </tr>
    </table>
  </subsection>

  <subsection name="SMTP Server Configuration">
   <p>
      These tag elements affect the SMTP listener (for incoming messages). 
   </p>

    <table border="1">
        <tr>
            <th>&lt;name&gt;</th>
            <th>default value</th>
            <th>meaning</th>
        </tr>
        <tr>
            <td> port </td>
            <td> 25 </td>
            <td> The port we are listening to. </td>
        </tr>
        <tr>
            <td> bind </td>
            <td> N.A. </td>
            <td> Specific IP addresses that you wish to bind this service to. </td>
        </tr>
        <tr>
            <td> smtphandler </td>
            <td> N.A. </td>
            <td> Parent for all SMTPHandler configuations. </td>
        </tr>
        <tr>
            <td> connectiontimeout </td>
            <td> 120000 </td>
            <td> If nothing is received from an open connection for more than {timeout] mills
            the connection is closed. </td>
        </tr>
    </table>
  </subsection>

  <subsection name="POP3 Server Configuration">
    <p>
       These tag elements affect the POP3 server (for message retrieval)
    </p>
    <table border="1">
        <tr>
            <th>&lt;name&gt;</th>
            <th>default value</th>
            <th>meaning</th>
        </tr>
        <tr>
            <td> port </td>
            <td> 110 </td>
            <td> The port we are listening to. </td>
        </tr>
        <tr>
            <td> bind </td>
            <td> N.A. </td>
            <td> Specific IP addresses that you wish to bind this service to. </td>
        </tr>
        <tr>
            <td> useTLS </td>
            <td> false </td>
            <td> Whether you wish to require/use TLS (SSL) on this port. </td>
        </tr>
        <tr>
            <td> pop3handler </td>
            <td> N.A. </td>
            <td> Parent for all POP3Handler configuations. </td>
        </tr>
        <tr>
            <td> connectiontimeout </td>
            <td> 120000 </td>
            <td> If nothing is received from an open connection for more than {timeout] mills
            the connection is closed. </td>
        </tr>
    </table>
  </subsection>

  <subsection name="Users Manager Configuration">
    <p>
       These tag elements affect the configuration of the list of local users.
    </p>
    <table border="1">
        <tr>
            <th>&lt;name&gt;</th>
            <th>default value</th>
            <th>meaning</th>
        </tr>
        <tr>
            <td> repository </td>
            <td> file://../var/users/ </td>
            <td> The path where local mail account informations are stored. </td>
        </tr>
    </table>
  </subsection>

  <subsection name="Remote Manager Configuration">
    <p>
       These tag elements affect the remote manager, a telnet based utility
       to manage the User Manager.
    </p>
    <table border="1">
        <tr>
            <th>&lt;name&gt;</th>
            <th>default value</th>
            <th>meaning</th>
        </tr>
        <tr>
            <td> port </td>
            <td> 4555 </td>
            <td> The port we are listening to. </td>
        </tr>
        <tr>
            <td> bind </td>
            <td> N.A. </td>
            <td> Specific IP addresses that you wish to bind this service to. </td>
        </tr>
        <tr>
            <td> useTLS </td>
            <td> false </td>
            <td> Whether you wish to require/use TLS (SSL) on this port. </td>
        </tr>
        <tr>
            <td> administrator_accounts </td>
            <td> N.A. </td>
            <td> The parent of &lt;account&gt; </td>
        </tr>
        <tr>
            <td> account </td>
            <td> login="root" password="root" </td>
            <td> A list of root account to administer JAMES. </td>
        </tr>
        <tr>
            <td> connectiontimeout </td>
            <td> 120000 </td>
            <td> If nothing is received from an open connection for more than {timeout] mills</td>
        </tr>
    </table>
  </subsection>

  <subsection name="Transport Configuration">
    <p>
       These tag elements affect SMTP remote delivery, specifically, DNS
       lookup functionality.
    </p>
   <table border="1">
        <tr>
            <th>&lt;name&gt;</th>
            <th>default value</th>
            <th>meaning</th>
        </tr>
        <tr>
            <td> dnsServer/servers/server </td>
            <td> N.A. </td>
            <td> This is a list of DNS to resolve external address. </td>
        </tr>
        <tr>
            <td> authoritative </td>
            <td> false </td>
            <td> Whether to require authoritative (non-cached) DNS records. Should always be false
            unless you understand the implications. </td>
        </tr>
        <tr>
            <td> repository </td>
            <td> file://../var/mail/delayed/ </td>
            <td> This is a temp repository path shared with the name of "TMP_REPOSITORY".
            It is used by the RemoteDelivery Mailet to store mail for futher delivery.
            (Note: this is not very elegant and will probally change soon) </td>
        </tr>
        <tr>
            <td> mailets </td>
            <td> rootpath="org.apache.james.transport.mailets." </td>
            <td> This is the parent node for all mailet configurations. The rootpath specify
            where mailet repository is. (Note: need to plug more than one repository) </td>
        </tr>
    </table>
  </subsection>
</section>

<section name="The Mailet processor pipeline">
  <p>
     This is James sitemap. It defines how each incoming mail will be
     processed. Incoming mails begins their process at the first mailet in the
     pipe. Each step is described by a &lt;servet&gt; tag with some attributes:
         &lt;mailet match="[matchClass]=[matchParameters]"
                    class="[mailetClass]"&gt;.
     The Match class split the mail into two: one with all recipients matching
     conditions and the other with all recipient not matching. All information
     in the mail except recipients cloned so bot matching and not matching are
     identical (again except recipients). The matching mail will be passed to
     the specified mailet for processing. After processing both mails, the
     untoched not matching and the processed matching, goes to next step in
     pipe. Some mailet will not return anything after process. The Null mailet
     for example will simply destroy any incoming mail or the RemoteDelivery
     since after delivery the mail needs no more processing.
  </p>

  <subsection name="Matches">
    <p>
       The Match interface defines how match class should work. Their work is
       to split a Vector of recipients into two: the ones matching a specified
       condition and all others. Condition may or may not be present. You can
       make one simple boolean operation merging two matches into one or you
       can write your own class implementing the Match interface.
       Currently implemented match:
    </p>
    <table border="1">
        <tr>
            <th>class name</th>
            <th>parameter</th>
            <th>action</th>
            <th>example</th>
        </tr>
        <tr>
            <td> All </td>
            <td> none </td>
            <td> match all recipients. </td>
            <td> match="All" </td>
        </tr>
        <tr>
            <td> HostIs </td>
            <td> comma separated list of hosts names </td>
            <td> match all recipient belonging to one of the specified hosts </td>
            <td> match="HostIs=myHost.mydom.org,yourHost" </td>
        </tr>
        <tr>
            <td> RecipientIs </td>
            <td> comma separated list of recipients </td>
            <td> match all recipients defined in condition. </td>
            <td> match="RecipientIs=root@localhost,admin@localhost" </td>
        </tr>
        <tr>
            <td> UserIs </td>
            <td> comma separated list of accounts </td>
            <td> match all recipients defined in condition regardless of host. </td>
            <td> match="UserIs=root,admin" </td>
        </tr>
        <tr>
            <td> HostIsLocal </td>
            <td> none </td>
            <td> check recipients's hosts against the list of host names set in configuration for localhost
            (see &lt;servername&gt;). </td>
            <td> match="HostIsLocal" </td>
        </tr>
        <tr>
            <td> RecipientIsLocal </td>
            <td> none </td>
            <td> match recipient which host is local (see HostIsLocal) and that are recognized by the
            Users Manager to be local accounts. </td>
            <td> match="RecipientIsLocal" </td>
        </tr>
        <tr>
            <td> SenderIs </td>
            <td> comma separated list of address. </td>
            <td> match all recipients if sender is in the condition string, else match none. </td>
            <td> match="SenderIs=badBay@badhost" </td>
        </tr>
        <tr>
            <td> RelayLimit </td>
            <td> Maximum number of hops. </td>
            <td> match all recipients if the message has more than the specified number of SMTP hops.
            Important to prevent race conditions in SMTP delivery.
            </td>
            <td> match="RelayLimit=30" </td>
        </tr>
        <tr>
            <td> SubjectIs </td>
            <td> comma separated list of address. </td>
            <td> match all recipients if the subject is equal to the condition string, else match none. </td>
            <td> match="SubjectIs=REMOVE" </td>
        </tr>
        <tr>
            <td> SubjectStartsWith </td>
            <td> comma separated list of address. </td>
            <td> match all recipients if the subject starts with the condition string, else match none. </td>
            <td> match="SubjectStartsWith: [ADV]" </td>
        </tr>
    </table>
    <p>
       Some examples:
       <br>
         - &lt;mailet match="RecipientIsLocal"
                     class="LocalDelivery"&gt;
       </br>
       <br>
        - &lt;mailet match="UserIs=root &amp; HostIsLocal"
                     class="Forward"&gt;
       </br>
       <br>
        - &lt;mailet match="SenderIs=badBoy@myhost,badGirl@yourhost"
                     class="Null"&gt;
       </br>
    </p>
  </subsection>

  <subsection name="Mailet">
    <p>
       Mailet are the ones performing a process on a message. They are
       provided with a Mail object on which thy can perform any kind of task
       and they reply with another Mail object  containing the response.  Wise
       use of mailet allow to write any mail based application as http
       application using mailet. Simple mailet provides basic mail
       functionality like mail forwarding, mailing list, "I'm on vacation"
       message, mail logging etc. As simply as these mailet, you can write
       and deploy your own mailet to perform any kind of task.
      <br>
         Here you are some mailet samples with their configuration:
       </br>
    </p>
    <b>Null</b>
    <blockquote>
        Destroy any incoming mail. No configuration needed.
        <br>
        &lt;mailet match="SenderIs=badBoy@badhost" class="Null"&gt;
        &lt;/mailet&gt;
        </br>
    </blockquote>
    <b>Identity</b>
    <blockquote>
         Leave any incoming mail untoched.Sort of debug mailet
         (not really useful).
         No configuration needed.
            <br>
            &lt;mailet match="All" class="Identity"&gt;
            &lt;/mailet&gt;</br>
    </blockquote>
    <b>Forward</b>
    <blockquote>
            Replace the recipient list with recipient specified in
            configurations.<br>
            &lt;mailet match="RecipientIs=root@localhost"
            class="Forward"&gt;</br>
      <blockquote>
       <br>
              &lt;forwardto&gt; green@blue.org &lt;/forwardto&gt;
       </br>
       <br>
              &lt;forwardto&gt; red@yellow.com &lt;/forwardto&gt;
       </br>
      </blockquote>
            &lt;/mailet&gt;
    </blockquote>

    <b>ToProcessor</b>
    <blockquote>
      Sends the incoming mail object to a new processor pipeline.
      <code>root</code> and <code>error</code> are special processors that
      should always be defined.
      <br>
        &lt;mailet match="RecipientIsLocal" class="ToProcessor"&gt;
      </br>
      <blockquote>
              &lt;processor&gt; localdelivery &lt;/processor&gt;
      </blockquote>
          &lt;/mailet&gt;
    </blockquote>

    <b>ServerTime</b>
    <blockquote>
      Replies to the sender with a short message with the current time.
      No configuration needed.
      <br>
        &lt;mailet match="RecipientIs=time@localhost" class="ServerTime"&gt;
      </br>
      &lt;/mailet&gt;
    </blockquote>

    <b>ToRepository</b>
    <blockquote>
      Stores mails in the specified MailRepository. Useful for mail logging
      etc.  If the passThrough is false the mail will be destroyed, if true
      it will be returned untouched to the pipe.
      <br>
        &lt;mailet match="RecipientIs=root@localhost"
                   class="ToRepository"&gt;
      </br>
      <blockquote>
        <br>
          &lt;repositoryPath&gt; file://../var/mail/logAdmin
                &lt;/repositoryPath&gt;
        </br>
        <br>
          &lt;passThrough&gt; true &lt;/passThrough&gt; (default false)
        </br>
      </blockquote>
            &lt;/mailet&gt;
    </blockquote>

    <b>LocalDelivery</b>
    <blockquote>
      Store mail in the local inbox, one folder for each user.
      <br>
        &lt;mailet match="RecipientIsLocal" class="LocalDelivery"&gt;
      </br>
        &lt;/mailet&gt;
    </blockquote>

    <b>RemoteDelivery</b>
    <blockquote>
        Realy mails to remote hosts. "delayTime" is the time in mills the
        mailet will wait
        before retrying sending a mail which fail at first time.
        "maxRetries" is the number of
        retries before sending back to sender the mail.
        <br>
          &lt;mailet match="!RecipientIsLocal" class="RemoteDelivery"&gt;
        </br>
      <blockquote>
        <br>
            &lt;delayTime&gt; 21600000 &lt;/delayTime&gt;
        </br>
        <br>
            &lt;maxRetries&gt; 5 &lt;/maxRetries&gt; 
        </br>
      </blockquote>
            &lt;/mailet&gt;
    </blockquote>

  </subsection>
</section>

</body>
</document>
