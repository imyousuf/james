<?xml version="1.0"?>
<avalon>
    <blocks>
        <block class="org.apache.james.James"
               serverName="James"
               implementedInterface="org.apache.avalon.blocks.MailServer">
               
            <postmaster> root@localhost </postmaster>
            <servernames>
<!--            <servername> To override autodetected server names uncomment this. </servername> -->
<!--            <servername> To override autodetected server names uncomment this. </servername> -->
<!--            <servername> To override autodetected server names uncomment this. </servername> -->
            </servernames>
<!-- Place here the path where incoming mail are temporaly stored before beeing processed.
     (ex. file://c:/james/spool/) -->
            <spoolRepository> file://../var/mail/spool/ </spoolRepository>

            <inboxRepository> file://../var/mail/localinbox/ </inboxRepository>

            <pop3Server>
                <port>110</port>
                <pop3handler>
                    <connectiontimeout> 120000 </connectiontimeout>
                </pop3handler>
            </pop3Server>
    
            <smtpServer>
                <port>25</port>
                <smtphandler>
                    <connectiontimeout> 120000 </connectiontimeout>
                </smtphandler>
            </smtpServer>
    
            <remoteManager>
                <port>4555</port>
                <administrator_accounts>
                    <account login="root" password="root"/>
                </administrator_accounts>
                <connectiontimeout> 60000 </connectiontimeout>
            </remoteManager>

            <usersManager>
                <repository> file://../var/users/ </repository>
            </usersManager>

            <spoolmanagerthreads> 1 </spoolmanagerthreads>
            <spoolmanager>
                <DNSservers>
<!-- +++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
<!-- !!!!!!!!!!!!!!!!!!!!!!! FILL ME !!!!!!!!!!!!!!!!!!!!!!! -->
<!-- Place here the list of your DNS servers, one for each <Server> tag-->
                    <server> </server>
                    <server> </server>
                    <server> </server>
<!-- !!!!!!!!!!!!!!!!!!!!!!! FILL ME !!!!!!!!!!!!!!!!!!!!!!! -->
<!-- +++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
                </DNSservers>
                <authoritative>false</authoritative>
                <repository> file://../var/mail/delayed/ </repository>
            
<!-- ++++++++++++ BEGIN OF MAIL SERVLET PIPE LINE +++++++++++++ -->
                <servlets rootpath="org.apache.james.transport.servlet.">

<!-- Thise servlet acts as system servlet and provides local delivery -->
                    <servlet match="RecipientIsLocal" class="LocalDelivery">
                    </servlet>

<!-- These servlet act as system servlet and provides remote deliver -->
                    <servlet match="!HostIsLocal" class="RemoteDelivery">
                        <delayTime>21600000</delayTime>
                        <maxRetyes>5</maxRetyes>
                    </servlet>

<!-- The last servlet in the pipe is the one managing errors -->
                    <servlet match="All" class="ToRepository">
                        <repositoryPath> file://../var/mail/errors/ </repositoryPath>
                        <passThrought> false </passThrought>
                    </servlet>
<!-- ++++++++++++ END OF MAIL SERVLET PIPE LINE +++++++++++++ -->
                </servlets>
            </spoolmanager>
        </block>

        <block class="org.apache.avalon.blocks.timeserver.TimeManager"
                serverName="James"
                implementedInterface="org.apache.avalon.blocks.TimeServer"
                help="Provide a simple interface to catch time events">
            <!-- No configurations needed for this block -->
        </block>

        <block class="org.apache.avalon.blocks.threadmanager.ThreadPool"
                serverName="James"
                implementedInterface="org.apache.avalon.blocks.ThreadManager"
                help="Takes care of execution of any Runnable in Avalon providing
                        a thread recycling capabilities">
            <levelcontroller help="Sets the level controller class for the thread pool">
                org.apache.java.recycle.GaussianController
            </levelcontroller>
            <capacity help="Sets thread pool initial capacity">
                64
            </capacity>
        </block>
    
        <block class="org.apache.avalon.blocks.omero.Omero"
               serverName="James"
               implementedInterface="org.apache.avalon.blocks.Logger"
               help="Provides a pluggable logging system">
            <timestamp>
                <granularity help="Sets the timestamp time granularity in 
                        milliseconds. If set to 0 means to use maximum time precision 
                        else timestam is calculated every 'granularity' milliseconds">
                    0
                </granularity>
                <format help="Define the format for the timestamp">
                    yyyy.MM.dd hh:mm:ss SSS 
                </format>
            </timestamp>
            <channels help="Every log call is performed througt a channel. 
                    The proposed pattern is: each application (Block) should use its own
                    channel to allow adminitrators to set what to log from that 
                    application and where to place logs. So if you plug a new server 
                    under Avalon you MUST place channel definition from that server
                    configuration file hereafter">
                <channel name="default"        loglevel="DEBUG"  logwriter="stdout"/>
                <channel name="system"         loglevel="DEBUG"  logwriter="infofile"/>
                <channel name="MasterStore"    loglevel="DEBUG"  logwriter="infofile"/>
                <channel name="ThreadManager"  loglevel="DEBUG"  logwriter="infofile"/>
                <channel name="TimeManager"    loglevel="DEBUG"  logwriter="infofile"/>
                <channel name="SocketManager"  loglevel="DEBUG"  logwriter="infofile"/>
                <channel name="RemoteManager"  loglevel="DEBUG"  logwriter="admin"/>
                <channel name="POP3Server"     loglevel="DEBUG"  logwriter="popfile"/>
                <channel name="SMTPServer"     loglevel="DEBUG"  logwriter="smtpfile"/>
                <channel name="JAMES"          loglevel="DEBUG"  logwriter="jamesfile"/>
                <channel name="Mail Servlet"   loglevel="DEBUG"  logwriter="jamesfile"/>
            </channels>
            <logwriters help="Each filtered channel goes to the specified logwriter.
                    Place here any additionl logwriter definition needed">
                <writer name="jamesfile" class="org.apache.avalon.blocks.omero.FileWriter">
                    <destination>
                        file://../logs/jamesinfo.log
                    </destination>
                    <buffersize>2048</buffersize>
                    <sleep>5000</sleep>
                </writer>
                <writer name="smtpfile" class="org.apache.avalon.blocks.omero.FileWriter">
                    <destination>
                        file://../logs/smtpinfo.log
                    </destination>
                    <buffersize>2048</buffersize>
                    <sleep>5000</sleep>
                </writer>
                <writer name="popfile" class="org.apache.avalon.blocks.omero.FileWriter">
                    <destination>
                        file://../logs/popinfo.log
                    </destination>
                    <buffersize>2048</buffersize>
                    <sleep>5000</sleep>
                </writer>
                <writer name="admin" class="org.apache.avalon.blocks.omero.FileWriter">
                    <destination>
                        file://../logs/admininfo.log
                    </destination>
                    <buffersize>2048</buffersize>
                    <sleep>5000</sleep>
                </writer>
                <writer name="stdout" class="org.apache.avalon.blocks.omero.StdoutWriter">
                    <destination>
                        stdout://
                    </destination>
                </writer>
                <writer name="infofile" class="org.apache.avalon.blocks.omero.FileWriter">
                    <destination>
                        file://../logs/info.log
                    </destination>
                    <buffersize>2048</buffersize>
                    <sleep>500</sleep>
                </writer>
            </logwriters>
        </block>
                
        <block class="org.apache.avalon.blocks.masterstore.MasterStore"
                serverName="James"
                implementedInterface="org.apache.avalon.blocks.Store"
                help="This is an imlpementation of the Store interface and 
                    provides a powerful interface to store any kind of objects. Its
                    power resides in its pluggable pattern.">
            <repositoriesDefinition help="Here goes Repository definitions. If
            an application needs its own Repository (see MailRepository
            for JAMES), it will place here its definition. These are default
            Repository.">
                <repository type="OBJECT" model="SYNCHRONOUS, ASYNCHRONOUS" 
                    destination="file://"
                    class="org.apache.avalon.blocks.masterstore.PersistentStore"/>
                <repository type="STREAM" model="SYNCHRONOUS, ASYNCHRONOUS"
                    destination="file://"
                    class="org.apache.avalon.blocks.masterstore.StreamStore"/>
                <repository type="MAIL" model="SYNCHRONOUS, ASYNCHRONOUS"
                    destination="file://"
                    class="org.apache.james.MailRepository"/>
            </repositoriesDefinition>
            <publicrepositories help="When an application needs a Repository for
                    its personal use it can just ask for a private Repository which will
                    be available only to caller application. If, on the other side, it 
                    needs to share that repository with other Block the Repository must 
                    be defined public since none of these block has 'the right' to own 
                    Repository configurations. Place here any public Repository definition">

<!--            <repository name="MyRepository" type="OBJECT" model="SYNCHRONOUS"> file://../myfolder/ </repository> -->
            </publicrepositories>
        </block>

        <block class="org.apache.avalon.blocks.serversocket.SocketManager"
               serverName="James"
               implementedInterface="org.apache.avalon.blocks.SocketServer"
               help="Provides an simple interface to catch Socket events">
            <listenerDefinition help="These are default socket listener. An 
                    application can implement an use its own lstener to perform
                    specific task (ex. FirewalledListener etc.)" >
                <listener type="DEFAULT" class="org.apache.avalon.blocks.serversocket.ServerSocketAcceptor">
                </listener>
                <listener type="IPFILTERING" class="org.apache.avalon.blocks.serversocket.AutenticatedServerSocketAcceptor">
                    <denied></denied>
                </listener>
            </listenerDefinition>
        </block>
        
    </blocks>
</avalon>
